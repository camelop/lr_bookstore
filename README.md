# 网上书店管理系统作业要求v6

SJTU-ACM Programming 2017

## 1.基本要求

本次大作业要用C++实现一个网上书店管理系统，其中：

- 要求将数据**存储在文件中**
- 支持本文档中给出的命令操作
- **不要求**完成GUI（当然允许并支持），但需提供**对应的，能力范围内用户友好的界面**来操作该系统
- 通过给定的数据测试

## 2.交互模式

### 关于模式

要求提供两种模式操作该系统：

- 系统管理员通过命令进行的直接操作
- 对电脑小白的通过数字选择即可完成操作的友好界面（友好程度**上不封顶**）

**注意**：若程序启动时检测到当前为第一次打开（之前未初始化过），**则会进行一次初始化**，其包括：

- 创建用户管理的相关文件结构，新建root用户（root用户名称[name]为root，默认密码[passwd]为sjtu）
- 创建书目、订单、日志管理的相关文件结构

### 关于数据测试

提交测试的程序在开始运行时（初始化后）**检测**运行目录下是否存在```command.txt```这一文件

若存在则默认执行一条下述命令来完成测试。

```
load command.txt
```

测试中可能**反复打开关闭提交的程序**以验证是否正确完成文件存储（后一次打开时会更换```command.txt```并保留前一次创建的文件）；

也可能使用**较多的命令**以测试是否正确完成存储所用的数据结构；

也可能**增加一些奇怪而又合理的数据点**以测试鲁棒性。

**对所有未成功的命令**（如命令不符合语法，买书时货不足，执行超过自己权限的命令等等），输出{Invalid\n}(不含大括号)，像这样

```
Invalid

```

有输出的命令输出格式**会特别指出**，请务必注意。

80%数据将在要求下发后两周内**分批放出**。

### 关于代码审查

检查内容包括正确通过测试和不存在```command.txt```时打开的用户交互的界面。

代码审查过程中中**会对程序的用户友好程度**进行检查。

## 3.用户系统

网上书店管理系统服务于**老板**，**员工**以及**客户**，满足其不同需求，故应该存在对应的用户管理部分。

### 角色划分

- 老板

  使用root账户，可以访问系统所有功能，可以进行用户管理以及批量操作。

- 员工

  可以且仅可以访问与自己业务相关的功能、数据。

- 顾客

  可以进行账户注册，查询书目以及书目购买，不能访问其他功能。

在权限上满足子集关系，即老板7>员工3>顾客1>未登录0。（权限编号7310仅为标识）

除root账户默认进行创建外，账户在创建时会规定账户类型，账户类型**不可更改**。

下面提到的命令后会通过对应数字注明权限信息，即

- 7为老板（root）专用
- 3为员工、老板均可使用
- 1为所有登录人员均可使用
- 0为未登录状态下也可使用

### 相关命令

为了满足批量操作的要求，设置如下命令：

```bash
load [destination] #7：从[destination]文件中读取每行一个的命令并由权限7（文件内先出现su）开始逐个执行
exit #0：退出程序
```

保证：load的目标文件中**不再出现load指令**。

用户系统使用如下命令：

```bash
su [user-id] [passwd]	#0：登录到某用户，从高权限用户登录到低权限不需填写密码
logout	#1：返回到未登录状态
useradd [user-id] [passwd] [7/3/1] [name]	#3：增加一个指定权限的用户，不能创建不小于自己权限的账户
register [user-id] [passwd] [name] #0：注册一个带有这些信息的权限1用户
delete [user-id] #7：删除某用户
passwd [user-id] [old-passwd(if not root)] [new-passwd] #1：root不需要填写旧密码，其余账户需要
```

[user-id] 和 [passwd] 包含连续无空格的数字字母下划线，不超过30个字符

[name] 中不含空格，不超过10个汉字

 ## 4.数据操作

### 不同角色的数据访问

- 老板

  了解财务情况，了解员工情况，了解库存，管理各类用户，查看日志，批量运行指令


- 员工

  查看自己的操作记录，添加图书种类并进货，了解库存，修改书目信息

- 客户

  查询图书，购买图书

### 相关指令

为了简化指令模式，我们规定一个**选定(select)**机制（只能选择唯一图书），修改和进货都在选中后进行。

注意：每次打开程序时默认select了空对象，即若此时进行import或modify视为Invalid。

```bash
select [ISBN]
	#3：选定ISBN为指定值的图书，若不存在则创建该ISBN的书并将其余信息留空等待modify进行填写
modify -ISBN=[ISBN] -name=[name] -author=[author] -keyword=[keyword] -price=[price]
	#3：参数可省略，也不要求输入顺序，会更新（替换而非添加）上次选中的书至新的信息
import [quantity] [cost_price(in total)]
	#3：将上次选中的书以总共[cost_price]的价格进[quantity]本
show -ISBN=[ISBN] -name=[name] -author=[author] -keyword=[keyword]
	#1：参数可省略，也不要求输入顺序，将匹配的图书以ISBN号排序输出，需要注意该命令关键字项只支持单关键字
show finance [time]
	#7：time项省略时，输出总的收入与支出；否则输出近[time]次进货、卖出操作（分别算一次）的收入支出。
buy [ISBN] [quantity] #1：购买该ISBN号的图书[quantity]本
```

其中

- [ISBN] 为不超过20位的连续字符串
- [name] 和 [author] **被双引号包起来（不含双引号）**，保证
  - 本身内容没有双引号
  - 内容不超过20个汉字
- [keyword] **整体被双引号包起来（不含双引号）**，关键字之间```|```(竖线)隔开，保证
  - 每个关键字本身内容无引号以及空格
  - 内容总共不超过20个汉字
- [quantity] 为整数（<100000）

对于show操作，输出格式为：每行一本，所有信息项目间以```\t```隔开，价格保留两位，库存后加”本“字，如：

```bash
$ show #允许无参数情况
7302294909	ACM国际大学生程序设计竞赛:知识与入门	俞勇	ACM|编程	28.10	1000本
9787313136275	C++程序设计	翁惠玉	C++|编程	29.00	1000本

```

对于show finance操作，格式为{+ [收入] - [支出]\n}(不含大括号)，如：

```
+ 200.94 - 150.50

```

**注意**：非管理员输入命令式的界面应该对**无参数**的show调用进行**一定程度的限制**

## 5.性能要求

所有的数据应以文件形式存储并进行维护。

**不允许**把所有东西直接放进内存，启动的时候加载然后关闭的时候放回，要动态的对文件进行访问和修改。

推荐使用**块状链表**，有能力者也可使用**B+树**。

对于不同参数的show命令**要建立不同的索引（倒排文档）**。

## 6.数据测试中不涉及但需完成的命令

```bash
report finance #7：会生成一张赏心悦目的财务报表，格式自定
report employee #7：会生成一张赏心悦目的员工工作情况表，记录其操作，格式自定
log #7：会返回赏心悦目的日志记录，包括系统操作类的谁干了什么，以及财务上每一笔交易情况，格式自定
report myself #3：返回员工自己的操作记录，格式自定
```
